# Steps to Setup a test platform using 2 bare-metal servers primarily to test connectivity using mtls

##tcnode6
./bin/mbg start --ip 10.20.20.1 --id mbg1 --cport 50051 --cportLocal 50051 --localDataPortRange 10000 --externalDataPortRange 10000 --rootCa /home/pravein/certs/ca.crt --certificate /home/pravein/certs/tcnode6-cert.pem --key /home/pravein/certs/tcnode6-key.pem --dataplane mtls

##tcnode7 
./bin/mbg start --id mbg2 --ip 10.20.20.2 --cport 50051 --cportLocal 50051 --localDataPortRange 10000 --externalDataPortRange 10000 --rootCa /home/pravein/certs/ca.crt --certificate /home/pravein/certs/tcnode7-cert.pem --key /home/pravein/certs/tcnode7-key.pem --dataplane mtls
./bin/mbg addMbg --id mbg1 --ip 10.20.20.1 --cport 50051
./bin/mbg hello
./bin/mbgctl addService --serviceId test-s --serviceIp 127.0.0.1:8000

## Cluster 1 (tcnode6)
./bin/mbgctl addService --serviceId test-d --serviceIp 127.0.0.1:8000
./bin/mbgctl expose --serviceId test-d

## Cluster 1 (tcnode6)
go run testservice.go --type server --port 8000

## Cluster 2 (tcnode7) Change 10081 according to the exposed cluster service port
go run testservice.go --type client --port 10081


----Generate Certificates-----
1) Root CA Certs - This is done once by a CA authority
mkdir certs
openssl req -newkey rsa:2048 -nodes -x509 -days 365 -out ca.crt -keyout ca.key

The certs can be issued by the authority now to MBGs
To generate the cert/key, use the following command
./genkeys <Name> <Host> <IP>